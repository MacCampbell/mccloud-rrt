---
title: "1100-new-pca"
author: "Mac Campbell"
date: "August 18, 2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning=FALSE, message=FALSE)
```

```{r}
library(tidyverse)
```

## Bring in new samples
I'm going to bring in a bunch of samples from Ensieh, in bams/sourced

/home/ehabibi/projects/redbandnewalign/bamfiles2.    

Are these the same as our original files? Yep yep.
(base) maccamp@farm:~/mccloud-rrt/bams$ samtools flagstat STLH_LSTN_01_RA.sort.flt.bam
851696 + 0 in total (QC-passed reads + QC-failed reads)

(base) maccamp@farm:~/mccloud-rrt/bams$ samtools flagstat sourced/STLH_LSTN_01_RA.sort.flt.bam
851696 + 0 in total (QC-passed reads + QC-failed reads)

Ensieh removed 19 individuals due to low read counts...

Let's show a PCA of the fish, color coded by PCAngsd admixture??

```{r}
meta<-read_csv("meta/bamlistall-nativetrout_metadata.csv")
samples<-read_tsv("meta/bamlistf_allnatives", col_names=c("bam"))

meta<-meta %>% filter(Bamlist %in% samples$bam) %>%
  mutate(Path=paste0("bams/sourced",Bamlist))

bamlist<-select(meta, Path)
write_tsv(bamlist, "bamlists/288.bamlist", col_names = FALSE)
```

meta %>% filter(!(Bamlist %in% samples$bam)) Gives me 19 samples, but 288 total

Calc beagle:
```{sh, eval=FALSE}
srun -p high -t 48:00:00 --mem=32G --nodes=2 $HOME/angsd/angsd -P 24  -bam bamlists/288.bamlist -GL 1 \
-doGLF 2 -doMajorMinor 1 -doMaf 2 -SNP_pval 1e6 -minMapQ 20 -minQ 20 -rf homoblocks/non-tetrasomic-non-inversion.txt \
-out outputs/1100/288 > outputs/1100/beagle.out 2> outputs/1100/beagle.err &
```
